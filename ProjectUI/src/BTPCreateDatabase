DROP DATABASE IF EXISTS BugTrackerPrime;

CREATE DATABASE BugTrackerPrime;

USE BugTrackerPrime;

CREATE TABLE SuperUser (
	UserID int NOT NULL AUTO_INCREMENT,
    ##AccessRights,
	AccessRights int NOT NULL,
	UserName varchar(30) UNIQUE,
	FName varchar(60),
	LName varchar(60),
	Email varchar(40),
	Password varchar(16),
	JoinedDate DATE,
	PRIMARY KEY(UserID)
);

CREATE TABLE RegisteredUser (
	UserID int NOT NULL DEFAULT 0,
    ##NATHAN: USER REPUTATION NEEDS TO BE INTEGER
    Role varchar(20),
    UserReputation int,
	BugReportCount int,
	AccountStatus ENUM('Active', 'Suspended', 'Deleted'),
	FOREIGN KEY (UserID)
		REFERENCES SuperUser(UserID)
		ON DELETE CASCADE
);

CREATE TABLE SysAdminUser (
	UserID int NOT NULL DEFAULT 0,
    Role varchar(20),
	# 	AssignedBug int,
	# 	AttachmentID int,
	FOREIGN KEY (UserID)
		REFERENCES SuperUser(UserID)
		ON DELETE CASCADE
);

##Not for comments
CREATE TABLE Attachments (
	AttachmentID int NOT NULL,
	CreationTimestamp DATE,
	ShortDescription varchar(200),
	FileName varchar(50),
	FileType varchar(50),
	FileSize int,
	AttacherID int,
	PRIMARY KEY (AttachmentID),
	FOREIGN KEY (AttacherID)
		REFERENCES SysAdminUser(UserID)
);

CREATE TABLE Bug (
	BugID int NOT NULL AUTO_INCREMENT,
	BugName varchar(50) NOT NULL UNIQUE,
	Product varchar(50),
	Component varchar(50),
	Version varchar(10),
	OperatingSystem varchar(50),
	PRIMARY KEY (BugID)
);

CREATE TABLE BugReports (
	BugReportID int NOT NULL AUTO_INCREMENT,
	CreationTimestamp datetime,
	ShortDescription varchar(200),
	DeltaTimestamp DATE,
	BugID int,
	BugStatus ENUM('Reported', 'Progressing', 'Solved'),
	Resolution varchar(500),
	Keywords varchar(50),
	Priority ENUM('Low', 'Medium', 'High', 'Emergency'),
	BugSeverity ENUM ('Critical', ' Major', 'Minor', 'Cosmetic'),
	ReporterID int,
	AssignedTo int,
    LongDescription VARCHAR(500),
	##CommentID int,
    ##NATHAN: THESE NOW WORK AND ARE NEEDED FOR WHEN
    ##YOU DO MULTIPLE JOINS TO RETRIEVE USERNAMES
	PRIMARY KEY (BugReportID),
	FOREIGN KEY (BugID)
		REFERENCES Bug(BugID),
	FOREIGN KEY (ReporterID)
		REFERENCES SuperUser(UserID),
	FOREIGN KEY (AssignedTo)
		REFERENCES SuperUser(UserID)
);

CREATE TABLE Comments (
	CommentID int NOT NULL AUTO_INCREMENT,
	UserID int,
    BugReportID int,
	CreationTimestamp DATE,
	CommentText varchar(500),
	PRIMARY KEY (CommentID),
	FOREIGN KEY (UserID)
		REFERENCES SuperUser(UserID),
	FOREIGN KEY (BugReportID)
		REFERENCES BugReports(BugReportID)
);

##### CREATE PROCEDURES/FUNCTIONS HERE ######
USE BugTrackerPrime;
DROP PROCEDURE IF EXISTS BugTrackerPrime.setCurrentUser;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `setCurrentUser`(uName VARCHAR(30))
	BEGIN
		SELECT SuperUser.UserID, UserName, FName, LName, Email, JoinedDate, UserReputation, AccountStatus, AccessRights FROM
			BugTrackerPrime.SuperUser JOIN BugTrackerPrime.RegisteredUser WHERE UserName = uname;
	END //
DELIMITER ;

DROP PROCEDURE IF EXISTS BugTrackerPrime.setCurrentAdmin;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `setCurrentAdmin`(uName VARCHAR(30))
	BEGIN
		SELECT SuperUser.UserID, UserName, FName, LName, Email, JoinedDate, Role, AccessRights FROM
			BugTrackerPrime.SuperUser JOIN BugTrackerPrime.SysAdminUser WHERE UserName = uname;
	END //
DELIMITER ;

DROP PROCEDURE IF EXISTS BugTrackerPrime.insertNewUser;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `insertNewUser`(IN uName varchar(20), IN fName varchar(20),
													IN lName varchar(20), IN email varchar(20),
													IN pWord varchar(20))
	BEGIN
		INSERT INTO SuperUser (AccessRights, UserName, FName, LName, Email, Password, JoinedDate)
		VALUES (1, uName, fName, lName, email, pWord, current_date());
		INSERT INTO RegisteredUser (UserID, UserReputation, BugReportCount, AccountStatus) VALUES
			((SELECT SuperUser.UserID FROM SuperUser WHERE SuperUser.UserName = uName), 0, 0, 'Active');

	END //
DELIMITER ;

DROP PROCEDURE IF EXISTS BugTrackerPrime.insertNewUserAdmin;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `insertNewUserAdmin`(IN ascLvl int, IN uName varchar(20), IN fName varchar(20),
													IN lName varchar(20), IN email varchar(20),
													IN pWord varchar(20))
	BEGIN
		INSERT INTO SuperUser (AccessRights, UserName, FName, LName, Email, Password, JoinedDate)
		VALUES (ascLvl, uName, fName, lName, email, pWord, current_date());
		INSERT INTO RegisteredUser (UserID, UserReputation, BugReportCount, AccountStatus) VALUES
			((SELECT SuperUser.UserID FROM SuperUser WHERE SuperUser.UserName = uName), 0, 0,'Active');

	END //
DELIMITER ;


DROP FUNCTION IF EXISTS BugTrackerPrime.verifyLogIn;
DELIMITER //
CREATE DEFINER='root'@'localhost'
FUNCTION `verifyLogIn`(uName VARCHAR(30), pass VARCHAR(16)) RETURNS INT DETERMINISTIC
	BEGIN
		DECLARE sLevel INT;
		DECLARE pWord VARCHAR(16);

		SELECT Password INTO pWord FROM BugTrackerPrime.SuperUser WHERE UserName = uName;

		IF(pWord = pass)
		THEN SELECT AccessRights INTO sLevel FROM BugTrackerPrime.SuperUser WHERE SuperUser.UserName = uName;
		ELSEIF(pWord != pass)
			THEN SET sLevel = 0;
		END IF;

		RETURN (sLevel);
	END //
DELIMITER ;

USE BugTrackerPrime;
DROP PROCEDURE IF EXISTS BugTrackerPrime.updateAdmin;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `updateAdmin`(uName VARCHAR(30), fName VARCHAR(60), lName VARCHAR(60), email VARCHAR(40),
												pWord VARCHAR(40))
	BEGIN
		UPDATE SuperUser SET FName = fName, LName = lName, Email = email, Password = pWord WHERE UserName = uname;
	END //
DELIMITER ;

USE BugTrackerPrime;
DROP PROCEDURE IF EXISTS BugTrackerPrime.updateAdminNoP;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `updateAdminNoP`(uName VARCHAR(30), fName VARCHAR(60), lName VARCHAR(60), email VARCHAR(40))
	BEGIN
		UPDATE SuperUser SET FName = fName, LName = lName, Email = email WHERE UserName = uname;
	END //
DELIMITER ;
#
DROP PROCEDURE IF EXISTS BugTrackerPrime.updateUser;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `updateUser`(uName VARCHAR(30), fName VARCHAR(60), lName VARCHAR(60), email VARCHAR(40),
												pWord VARCHAR(40))
	BEGIN
		UPDATE SuperUser SET FName = fName, LName = lName, Email = email, Password = pWord WHERE UserName = uname;
	END //
DELIMITER ;

USE BugTrackerPrime;
DROP PROCEDURE IF EXISTS BugTrackerPrime.updateUserNoP;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `updateUserNoP`(uName VARCHAR(30), fName VARCHAR(60), lName VARCHAR(60), email VARCHAR(40))
	BEGIN
		UPDATE SuperUser SET FName = fName, LName = lName, Email = email WHERE UserName = uname;
	END //
DELIMITER ;

DROP PROCEDURE IF EXISTS BugTrackerPrime.deleteUser;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE deleteUser(userToDel VARCHAR(30))
	BEGIN
		DELETE FROM BugTrackerPrime.SuperUser WHERE UserName = userToDel;
	END //
DELIMITER ;

#

##NATHAN: NEW UPDATED
DROP PROCEDURE IF EXISTS BugTrackerPrime.setSearchDetailsByStatus;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `setSearchDetailsByStatus`(bStatus ENUM('Reported', 'Progressing', 'Solved'))
	BEGIN
		SELECT DISTINCT BugReportID, CreationTimestamp, ShortDescription, BugStatus, Priority, bug.BugName, superuser.UserName
        FROM  BugTrackerPrime.BugReports
        LEFT JOIN BugTrackerPrime.bug 
        ON BugReports.BugID = Bug.BugID
        LEFT JOIN BugTrackerPrime.superuser 
        ON BugReports.ReporterID = superuser.UserID
		WHERE BugStatus = bStatus;
	END //
DELIMITER ;
##NATHAN: ADDED
DROP PROCEDURE IF EXISTS BugTrackerPrime.setSearchDetailsByPriority;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `setSearchDetailsByPriority`(bPrio ENUM('Low', 'Medium', 'High', 'Emergency'))
	BEGIN
		SELECT DISTINCT BugReportID, CreationTimestamp, ShortDescription, BugStatus, Priority, bug.BugName, superuser.UserName
        FROM  BugTrackerPrime.BugReports
        LEFT JOIN BugTrackerPrime.bug 
        ON BugReports.BugID = Bug.BugID
        LEFT JOIN BugTrackerPrime.superuser 
        ON BugReports.ReporterID = superuser.UserID
		WHERE Priority = bPrio;
	END //
DELIMITER ;

##NATHAN: ADDED
DROP PROCEDURE IF EXISTS BugTrackerPrime.setSearchDetailsByUser;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `setSearchDetailsByUser`(repName varchar(20))
	BEGIN
		SELECT DISTINCT BugReportID, CreationTimestamp, ShortDescription, BugStatus, Priority, bug.BugName, superuser.UserName
        FROM  BugTrackerPrime.BugReports
        LEFT JOIN BugTrackerPrime.bug 
        ON BugReports.BugID = Bug.BugID
        LEFT JOIN BugTrackerPrime.superuser 
        ON BugReports.ReporterID = superuser.UserID
		WHERE superuser.UserName = repName;
	END //
DELIMITER ;

DROP PROCEDURE IF EXISTS BugTrackerPrime.setFindComments;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `setFindComments`(brID INT)
	BEGIN
		SELECT DISTINCT Comments.CreationTimestamp, CommentText, superuser.UserName
        FROM  BugTrackerPrime.Comments
        LEFT JOIN BugTrackerPrime.BugReports 
        ON Comments.BugReportID = BugReports.BugReportID
        LEFT JOIN BugTrackerPrime.superuser 
        ON Comments.UserID = superuser.UserID
		WHERE BugReports.BugReportID = brID;
	END //
DELIMITER ;

##NATHAN: UPDATED
DROP PROCEDURE IF EXISTS BugTrackerPrime.populateExtReportDetails;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `populateExtReportDetails`(bId INT)
	BEGIN
		SELECT BugName, Bug.BugID, BugStatus, Priority, CreationTimestamp, Product, OperatingSystem, Component, Version,
			BugSeverity, a.UserName, b.UserName, LongDescription, Resolution
		FROM BugTrackerPrime.Bug 
        LEFT JOIN BugTrackerPrime.BugReports 
        ON Bug.BugID = BugReports.BugID
        LEFT JOIN BugTrackerPrime.superuser a
        ON BugReports.ReporterID = a.UserID
        LEFT JOIN BugTrackerPrime.superuser b
        ON BugReports.AssignedTo = b.UserID
		WHERE BugReportID = bId;
	END //
DELIMITER ;


##########################
DROP PROCEDURE IF EXISTS BugTrackerPrime.insertNewComment;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `insertNewComment`(IN uID int, IN brID INT, cmnt varchar(500))
	BEGIN
		INSERT INTO Comments (userID, bugReportID, creationTimestamp, commentText)
		VALUES (uID, brID, CURDATE(), cmnt);
	END //
DELIMITER ;

################################# REPORT PROCEDURES #####################################################
DROP PROCEDURE IF EXISTS BugTrackerPrime.newBugReports;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `newBugReports`(timeRange INT)
	BEGIN
		SELECT COUNT(*) FROM BugTrackerPrime.BugReports WHERE (CreationTimestamp BETWEEN DATE_SUB(CURDATE(), INTERVAL timeRange DAY) AND CURDATE());
	END //
DELIMITER ;

USE BugTrackerPrime;
DROP PROCEDURE IF EXISTS BugTrackerPrime.countReportsAssigned;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `countReportsAssigned`(timeRange INT)
	BEGIN
		SELECT COUNT(*) FROM BugTrackerPrime.BugReports WHERE (CreationTimestamp BETWEEN DATE_SUB(CURDATE(), INTERVAL timeRange DAY) AND CURDATE()) AND AssignedTo IS NOT NULL ;
	END //
DELIMITER ;

USE BugTrackerPrime;
DROP PROCEDURE IF EXISTS BugTrackerPrime.countReportsUnassigned;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `countReportsUnassigned`(timeRange INT)
	BEGIN
		SELECT COUNT(*) FROM BugTrackerPrime.BugReports WHERE (CreationTimestamp BETWEEN DATE_SUB(CURDATE(), INTERVAL timeRange DAY) AND CURDATE()) AND AssignedTo IS NULL ;
	END //
DELIMITER ;

DROP PROCEDURE IF EXISTS BugTrackerPrime.countReportedBugs;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `countReportedBugs`(timeRange INT)
	BEGIN
		SELECT COUNT(*) FROM BugTrackerPrime.BugReports WHERE (CreationTimestamp BETWEEN DATE_SUB(CURDATE(), INTERVAL timeRange DAY) AND CURDATE()) AND BugStatus = 'Reported' ;
	END //
DELIMITER ;

DROP PROCEDURE IF EXISTS BugTrackerPrime.countProgressBugs;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `countProgressBugs`(timeRange INT)
	BEGIN
		SELECT COUNT(*) FROM BugTrackerPrime.BugReports WHERE (CreationTimestamp BETWEEN DATE_SUB(CURDATE(), INTERVAL timeRange DAY) AND CURDATE()) AND BugStatus = 'Progressing' ;
	END //
DELIMITER ;

DROP PROCEDURE IF EXISTS BugTrackerPrime.countSolvedBugs;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `countSolvedBugs`(timeRange INT)
	BEGIN
		SELECT COUNT(*) FROM BugTrackerPrime.BugReports WHERE (CreationTimestamp BETWEEN DATE_SUB(CURDATE(), INTERVAL timeRange DAY) AND CURDATE()) AND BugStatus = 'Solved' ;
	END //
DELIMITER ;

DROP PROCEDURE IF EXISTS BugTrackerPrime.countLowPriority;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `countLowPriority`(timeRange INT)
	BEGIN
		SELECT COUNT(*) FROM BugTrackerPrime.BugReports WHERE (CreationTimestamp BETWEEN DATE_SUB(CURDATE(), INTERVAL timeRange DAY) AND CURDATE()) AND Priority = 'Low' ;
	END //
DELIMITER ;

DROP PROCEDURE IF EXISTS BugTrackerPrime.countMedPriority;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `countMedPriority`(timeRange INT)
	BEGIN
		SELECT COUNT(*) FROM BugTrackerPrime.BugReports WHERE (CreationTimestamp BETWEEN DATE_SUB(CURDATE(), INTERVAL timeRange DAY) AND CURDATE()) AND Priority = 'Medium' ;
	END //
DELIMITER ;

DROP PROCEDURE IF EXISTS BugTrackerPrime.countHighPriority;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `countHighPriority`(timeRange INT)
	BEGIN
		SELECT COUNT(*) FROM BugTrackerPrime.BugReports WHERE (CreationTimestamp BETWEEN DATE_SUB(CURDATE(), INTERVAL timeRange DAY) AND CURDATE()) AND Priority = 'High' ;
	END //
DELIMITER ;

DROP PROCEDURE IF EXISTS BugTrackerPrime.countEmergencyPriority;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `countEmergencyPriority`(timeRange INT)
	BEGIN
		SELECT COUNT(*) FROM BugTrackerPrime.BugReports WHERE (CreationTimestamp BETWEEN DATE_SUB(CURDATE(), INTERVAL timeRange DAY) AND CURDATE()) AND Priority = 'Emergency' ;
	END //
DELIMITER ;

DROP PROCEDURE IF EXISTS BugTrackerPrime.countCosmeticSev;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `countCosmeticSev`(timeRange INT)
	BEGIN
		SELECT COUNT(*) FROM BugTrackerPrime.BugReports WHERE (CreationTimestamp BETWEEN DATE_SUB(CURDATE(), INTERVAL timeRange DAY) AND CURDATE()) AND BugSeverity = 'Cosmetic' ;
	END //
DELIMITER ;

DROP PROCEDURE IF EXISTS BugTrackerPrime.countMinorSev;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `countMinorSev`(timeRange INT)
	BEGIN
		SELECT COUNT(*) FROM BugTrackerPrime.BugReports WHERE (CreationTimestamp BETWEEN DATE_SUB(CURDATE(), INTERVAL timeRange DAY) AND CURDATE()) AND BugSeverity = 'Minor' ;
	END //
DELIMITER ;

DROP PROCEDURE IF EXISTS BugTrackerPrime.countMajorSev;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `countMajorSev`(timeRange INT)
	BEGIN
		SELECT COUNT(*) FROM BugTrackerPrime.BugReports WHERE (CreationTimestamp BETWEEN DATE_SUB(CURDATE(), INTERVAL timeRange DAY) AND CURDATE()) AND BugSeverity = 'Major' ;
	END //
DELIMITER ;

DROP PROCEDURE IF EXISTS BugTrackerPrime.countCriticalSev;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `countCriticalSev`(timeRange INT)
	BEGIN
		SELECT COUNT(*) FROM BugTrackerPrime.BugReports WHERE (CreationTimestamp BETWEEN DATE_SUB(CURDATE(), INTERVAL timeRange DAY) AND CURDATE()) AND BugSeverity = 'Critical' ;
	END //
DELIMITER ;

######################### Submit Report ##############################################################################
DROP PROCEDURE IF EXISTS BugTrackerPrime.submitReport;
DELIMITER //
CREATE DEFINER='root'@'localhost'
PROCEDURE `submitReport`(bName VARCHAR(50), prod VARCHAR(50), compon VARCHAR(50), vers VARCHAR(10), oSys VARCHAR(50),
                         bStatus VARCHAR(30), kWords VARCHAR(50), prio VARCHAR(30), bSev VARCHAR(30), lDesc VARCHAR(500), assi VARCHAR(30))
  BEGIN
    INSERT INTO BugTrackerPrime.Bug (BugName, Product, Component, Version, OperatingSystem)
    VALUES (bName, prod, compon, vers, oSys);

    INSERT INTO BugTrackerPrime.BugReports (CreationTimestamp, BugID, BugStatus, Keywords, Priority, BugSeverity, LongDescription , AssignedTo)
    VALUES (current_date, (SELECT BugID FROM BugTrackerPrime.Bug WHERE BugName = bName), bStatus, kWords, prio, bSev, lDesc,
            (SELECT UserID FROM BugTrackerPrime.SuperUser WHERE UserName = assi));
  END //
DELIMITER ;

#### CREATE NEW USERS AND PRIVS HERE ####
DROP USER 'newUser'@'localhost';
CREATE USER 'newUser'@'localhost' IDENTIFIED BY 'pass123';
GRANT INSERT, SELECT ON BugTrackerPrime.SuperUser TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
GRANT INSERT, SELECT ON BugTrackerPrime.RegisteredUser TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.insertNewUser TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.setCurrentUser TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.setCurrentAdmin TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON FUNCTION BugTrackerPrime.verifyLogIn TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.updateAdmin TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.updateAdminNoP TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.insertNewUserAdmin TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.setSearchDetailsByStatus TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.setSearchDetailsByUser TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.setSearchDetailsByPriority TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.setFindComments TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.populateExtReportDetails TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.insertNewComment TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.deleteUser TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.updateUser TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.updateUserNoP TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
########################################## REPORT PROCEDURE PRIVS ####################################################
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.newBugReports TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.countReportsAssigned TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.countReportsUnassigned TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.countReportedBugs TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.countProgressBugs TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.countSolvedBugs TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.countLowPriority TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.countMedPriority TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.countHighPriority TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.countEmergencyPriority TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.countCosmeticSev TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.countMinorSev TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.countMajorSev TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;
GRANT EXECUTE ON PROCEDURE BugTrackerPrime.countCriticalSev TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;

GRANT EXECUTE ON PROCEDURE BugTrackerPrime.submitReport TO 'newUser'@'localhost' IDENTIFIED BY 'pass123';
FLUSH PRIVILEGES;

### INSERT TEST DATA HERE ####

#INSERTS A REGISTERED USER
INSERT INTO SuperUser(AccessRights, UserName, FName, LName, Email, Password, JoinedDate)
VALUES (1, 'auser','Alex', 'User', 'auser@btp.com', 'pass123', current_date());

INSERT INTO RegisteredUser VALUES ((SELECT UserID FROM SuperUser WHERE UserName = 'auser'),'User', 0 ,0,'Active');

#INSERTS A SYSADMIN USER
INSERT INTO SuperUser(AccessRights, UserName, FName, LName, Email, Password, JoinedDate)
VALUES (2, 'rep','Jill', 'User', 'buser@btp.com', 'pass123', current_date());
INSERT INTO SysAdminUser VALUES ((SELECT UserID FROM SuperUser WHERE UserName = 'rep'), 'Reporter');

INSERT INTO SuperUser(AccessRights, UserName, FName, LName, Email, Password, JoinedDate)
VALUES (3, 'dev','Dave', 'User', 'buser@btp.com', 'pass123', current_date());
INSERT INTO SysAdminUser VALUES ((SELECT UserID FROM SuperUser WHERE UserName = 'dev'), 'Developer');

INSERT INTO SuperUser(AccessRights, UserName, FName, LName, Email, Password, JoinedDate)
VALUES (4, 'tri','Jack', 'User', 'buser@btp.com', 'pass123', current_date());
INSERT INTO SysAdminUser VALUES ((SELECT UserID FROM SuperUser WHERE UserName = 'tri'), 'Triage');

INSERT INTO SuperUser(AccessRights, UserName, FName, LName, Email, Password, JoinedDate)
VALUES (5, 'buser','Bob', 'User', 'buser@btp.com', 'pass123', current_date());
INSERT INTO SysAdminUser VALUES ((SELECT UserID FROM SuperUser WHERE UserName = 'buser'), 'SysAdmin');

#INSERTS A BUG AND A BUG REPORT
INSERT INTO Bug(BugName, Product, Component, Version, OperatingSystem)
VALUES ('Bug 1', 'Bug Tracker Prime', 'Database', 'v0.4', 'Windows');

INSERT INTO Bug(BugName, Product, Component, Version, OperatingSystem)
VALUES ('Bug 2', 'Bug Tracker Prime', 'Database', 'v0.4', 'Windows');

INSERT INTO Bug(BugName, Product, Component, Version, OperatingSystem)
VALUES ('Bug 3', 'Bug Tracker Prime', 'Database', 'v0.4', 'Windows');


#############
INSERT INTO BugReports(CreationTimestamp, ShortDescription, DeltaTimestamp, BugID, BugStatus,
											 Resolution, Keywords, Priority, BugSeverity, ReporterID, AssignedTo, LongDescription)
VALUES (current_date(), 'this is a short description', current_date(), (SELECT BugID FROM Bug WHERE BugName = 'Bug 1'), 'Reported',
							 'This is a resolution for bug 1', 'Some Keywords here', 'Medium', 'Minor', 2, 3,
								'This is Bug 1, its a very nice bug and just wants to be your friend');

INSERT INTO BugReports(CreationTimestamp, ShortDescription, DeltaTimestamp, BugID, BugStatus,
											 Resolution, Keywords, Priority, BugSeverity, ReporterID, AssignedTo, LongDescription)
VALUES (current_date(), 'PROGRESSING THIS IS GREAT', current_date(), (SELECT BugID FROM Bug WHERE BugName = 'Bug 2'), 'Progressing',
							 'This is a resolution for bug 2', 'Some Keywords here', 'Medium', 'Minor', 2, 3,
								'This is Bug 2, Bug 2 is not nice, it likes darkness, moist moist areas and the smell of burning rubber');

INSERT INTO BugReports(CreationTimestamp, ShortDescription, DeltaTimestamp, BugID, BugStatus,
											 Resolution, Keywords, Priority, BugSeverity, ReporterID, AssignedTo, LongDescription)
VALUES (current_date(), 'THIS HAS BEEN SOLVED!!!', current_date(), (SELECT BugID FROM Bug WHERE BugName = 'Bug 3'), 'Solved',
							 'This is a resolution for bug 3', 'Some Keywords here', 'Medium', 'Minor', 2, 3,
								'This is Bug 3, it is also a very very nice bug. It likes sunshine, beaches and playing in the sun');


INSERT INTO Comments(CreationTimestamp, UserID, CommentText, BugReportID) VALUES (current_date(), 3, 'This is a comment', 2);

INSERT INTO Comments(CreationTimestamp, UserID, CommentText, BugReportID) VALUES (current_date(), 3, 'Another Comment', 3);
